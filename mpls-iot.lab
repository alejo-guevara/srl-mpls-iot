#
# SRL MPLS IOT lab featuring SROS and VMX
#
name: mpls-iot-lab

topology:
  defaults:
    config:
      vars:
        overlay_as: 65555 # 32-bit
#----------------------------------------------------#
  kinds:
    srl:
      # Need IXR D2 or D3 for EVPN/VXLAN support
      type: ixrd2 # See https://www.nokia.com/networks/products/7250-interconnect-router/
      image: srl/netbox-agent:latest
      extras:
        srl-agents:
        - ../srl-self-organizing/auto-config-agent.yml
        - ../srl-netbox-agent/srl-netbox-agent.yml
      startup-config: configs/srl-auto.cfg.json
      # binds:

    vr-sros:
      image: vrnetlab/vr-sros:21.7.R2
      type: sr-1
      license: ~/sros/SR_OS_VSR_license.txt

    vr-vmx:
      image: vrnetlab/vr-vmx:21.1R1.11

    linux:
      image: frr-with-lldp:latest

  nodes:
  #-----------------------------------------------------#
    dcgw1:
      kind: vr-sros
      group: dc
      type: sr-1
      config:
        vars:
          system_ip: 10.0.0.31
          as: 65030
    #-----------------------------------------------------#
    dcgw2:
      kind: vr-sros
      group: dc
      type: sr-1
      config:
        vars:
          system_ip: 10.0.0.32
          as: 65030
    #-----------------------------------------------------#
    spine1.dc1:
      kind: srl
      group: dc1
    sros1:
      kind: vr-sros
      group: pop1
      type: sr-2
      config:
        vars:
          system_ip: 10.0.0.33
          as: 65031
    vmx1:
      kind: vr-vmx
      group: pop2
      config:
        vars:
          system_ip: 10.0.0.34
          as: 65032

    h1: { kind: linux, group: hosts, binds: [ configs/h1/frr.conf:/etc/frr/frr.conf ] }

  links:
    # SROS and VMX connected
    - endpoints: ["sros1:e1-1", "vmx1:eth1"]

    # SRL connected to each node
    - endpoints: ["spine1.dc1:e1-1", "sros1:e1-2"]
    - endpoints: ["spine1.dc1:e1-2", "vmx1:eth2"]

    # A host connected to each SRL on e1-3
    - endpoints: ["spine1.dc1:e1-3", "h1:eth1"]
